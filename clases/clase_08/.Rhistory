mutate(religion = as.character(religion)) %>%
mutate(religion = if_else(religion %in% c("Sin respuesta", "No aplica"), as.character(NA), religion)) %>%
freq(religion, prop = TRUE, order = "freq", report.nas =  FALSE)  %>%
tb()
f_religion <- datos %>%
filter (!(religion =="Sin respuesta")) %>%
count(religion) %>%
mutate(Porcentaje = n / sum(n) * 100) %>%
mutate(Porcentaje = round (Porcentaje, 2)) %>%
arrange(desc(Porcentaje)) %>%
rename(Frecuencia = n, Religion= religion)
datos %>%
filter (!(religion =="Sin respuesta")) %>%
count(religion) %>%
mutate(Porcentaje = n / sum(n) * 100) %>%
mutate(Porcentaje = round (Porcentaje, 2)) %>%
arrange(desc(Porcentaje)) %>%
rename(Frecuencia = n, Religion= religion)
# gráfico de columnas: geom_col()
names(f_religion)
ggplot(f_religion, aes(x = Religion, y = Frecuencia)) +
geom_col()
View(f_religion)
# para alinear los nombres de las etiquetas
ggplot(f_religion, aes(x = Religion, y = Frecuencia)) +
geom_col() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
# para alinear los nombres de las etiquetas
ggplot(f_religion, aes(x = Religion, y = Frecuencia)) +
geom_col() +
theme(axis.text.x = element_text(angle = 90, hjust = 2))
# para alinear los nombres de las etiquetas
ggplot(f_religion, aes(x = Religion, y = Frecuencia)) +
geom_col() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
# para alinear los nombres de las etiquetas
ggplot(f_religion, aes(x = Religion, y = Frecuencia)) +
geom_col() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# para alinear los nombres de las etiquetas
ggplot(f_religion, aes(x = Religion, y = Frecuencia)) +
geom_col() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
#¿Qué se le podría arreglar?
names(f_religion)
ggplot(f_religion, aes(x = fct_reorder(Religion, Frecuencia), y = Frecuencia)) +
geom_col() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) #ajusto etiquetas
#Ordenar de mayor a menor
ggplot(f_religion, aes(x = fct_reorder(Religion, Frecuencia, desc), y = Frecuencia)) + #con desc
geom_col() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(f_religion, aes(x = Frecuencia, y = fct_reorder(Religion, Frecuencia))) +
geom_col() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(f_religion, aes(x = fct_reorder(Religion, Frecuencia), y = Frecuencia)) +
geom_col() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))+
coord_flip()
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje))) +
geom_col() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))+
labs (title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
x = "%",
y = "Religiones",
caption = "fuente: Libreria Datos")
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje))) +
geom_col() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))+
labs (title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos")+
xlab("") + ylab("") # se fue lo que decía Religiones y el %
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje))) +
geom_col() +
geom_text(aes(label = paste0(round(Porcentaje, 1), "%")), #concatena porcentaje con un decimal y "%".
hjust = -0.1, size = 3) +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
xlab("") + ylab("") +
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos")
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje))) +
geom_col(fill = "gray70") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
xlab("") + ylab("") +
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos")+
geom_text(aes(label = paste0(round(Porcentaje, 1), "%")), #concatena porcentaje con un decimal y "%".
hjust = -0.1, size = 3)
#le agrego color gris
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje))) +
geom_col(fill = "tomato") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
xlab("") + ylab("") +
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos")+
geom_text(aes(label = paste0(round(Porcentaje, 1), "%")), #concatena porcentaje con un decimal y "%".
hjust = -0.1, size = 3)
#le agrego un tema, hago que esté en negrita y xon nudge que las barras se separen
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje))) +
geom_col(fill = "gray70") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
xlab("") + ylab("") +
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos")+
geom_text(aes(label = paste0(round(Porcentaje, 1), "%")), #concatena porcentaje con un decimal y "%".
hjust = -0.1, size = 3, nudge_x = -.9, fontface= "bold")+
theme_minimal()
#le agrego un tema, hago que esté en negrita y xon nudge que las barras se separen
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje))) +
geom_col(fill = "gray70") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
xlab("") + ylab("") +
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos")+
geom_text(aes(label = paste0(round(Porcentaje, 1), "%")), #concatena porcentaje con un decimal y "%".
hjust = -0.1, size = 3, nudge_x = -.9, fontface= "bold")+
theme_economist()
#le agrego un tema, hago que esté en negrita y xon nudge que las barras se separen
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje))) +
geom_col(fill = "gray70") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
xlab("") + ylab("") +
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos")+
geom_text(aes(label = paste0(round(Porcentaje, 1), "%")), #concatena porcentaje con un decimal y "%".
hjust = -0.1, size = 3, nudge_x = -.9, fontface= "bold")+
theme_economist_white()
#le agrego un tema, hago que esté en negrita y xon nudge que las barras se separen
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje))) +
geom_col(fill = "gray70") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
xlab("") + ylab("") +
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos")+
geom_text(aes(label = paste0(round(Porcentaje, 1), "%")), #concatena porcentaje con un decimal y "%".
hjust = -0.1, size = 3, nudge_x = -.9, fontface= "bold")+
theme_ipsum()
#le agrego un tema, hago que esté en negrita y xon nudge que las barras se separen
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje))) +
geom_col(fill = "tomato") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
xlab("") + ylab("") +
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos")+
geom_text(aes(label = paste0(round(Porcentaje, 1), "%")), #concatena porcentaje con un decimal y "%".
hjust = -0.1, size = 3, nudge_x = -.9, fontface= "bold")+
theme_ipsum()
unique(f_religion$Religion)
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje), fill = Religion)) +
geom_col() +
xlab("") + ylab("") +
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos") +
geom_text(aes(label = ifelse(Religion %in% c("Protestante", "Católica", "Ninguna", "Cristiana"), Porcentaje, "")),
hjust = 1, nudge_x = -.5, size = 4, fontface = "bold") +
theme_minimal()+
scale_fill_viridis_d(option = "C", guide = "none")
#quiero cambiar los colores y sólo le pondré porcentajes a algunos
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje), fill = Religion)) +
geom_col() +
xlab("") + ylab("") +
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos") +
geom_text(aes(label = ifelse(Religion %in% c("Protestante", "Católica", "Ninguna", "Cristiana"), Porcentaje, "")),
hjust = 1, nudge_x = -.5, size = 4, fontface = "bold") +
theme_minimal()+
scale_fill_economist(option = "C", guide = "none")
#quiero cambiar los colores y sólo le pondré porcentajes a algunos
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje), fill = Religion)) +
geom_col() +
xlab("") + ylab("") +
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos") +
geom_text(aes(label = ifelse(Religion %in% c("Protestante", "Católica", "Ninguna", "Cristiana"), Porcentaje, "")),
hjust = 1, nudge_x = -.5, size = 4, fontface = "bold") +
theme_minimal()+
scale_fill_economist( guide = "none")
#quiero cambiar los colores y sólo le pondré porcentajes a algunos
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje), fill = Religion)) +
geom_col() +
xlab("") + ylab("") +
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos") +
geom_text(aes(label = ifelse(Religion %in% c("Protestante", "Católica", "Ninguna", "Cristiana"), Porcentaje, "")),
hjust = 1, nudge_x = -.5, size = 4, fontface = "bold") +
theme_minimal()+
scale_fill_viridis_d(option = "C", guide = "none")
#quiero cambiar los colores y sólo le pondré porcentajes a algunos
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje), fill = Religion)) +
geom_col() +
xlab("") + ylab("") +
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos") +
geom_text(aes(label = ifelse(Religion %in% c("Protestante", "Católica", "Ninguna", "Cristiana"), Porcentaje, "")),
hjust = 1, nudge_x = -.5, size = 4, fontface = "bold") +
theme_minimal()+
scale_fill_viridis_d( guide = "none")
#quiero cambiar los colores y sólo le pondré porcentajes a algunos
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje), fill = Religion)) +
geom_col() +
xlab("") + ylab("") +
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos") +
geom_text(aes(label = ifelse(Religion %in% c("Protestante", "Católica", "Ninguna", "Cristiana"), Porcentaje, "")),
hjust = 1, nudge_x = -.5, size = 4, fontface = "bold") +
theme_minimal()+
scale_fill_viridis_d(option = "C")
#quiero cambiar los colores y sólo le pondré porcentajes a algunos
ggplot(f_religion, aes(x = Porcentaje, y = fct_reorder(Religion, Porcentaje), fill = Religion)) +
geom_col() +
xlab("") + ylab("") +
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos") +
geom_text(aes(label = ifelse(Religion %in% c("Protestante", "Católica", "Ninguna", "Cristiana"), Porcentaje, "")),
hjust = 1, nudge_x = -.5, size = 4, fontface = "bold") +
theme_minimal()+
scale_fill_viridis_d(option = "C", guide = "none")
ggplot(datos, aes(x = religion)) +
geom_bar()
View(datos)
ggplot(datos, aes(x = fct_reorder(religion, religion, function(x) sum(datos$religion == x)), y = ..count..)) +
geom_bar()
View(f_religion)
View(f_religion)
f_religion$Religion <- factor(f_religion$Religion, levels = f_religion$Religion[order(f_religion$Porcentaje)])
ggplot(f_religion, aes(x = "", y = Porcentaje, fill = Religion)) +
geom_bar(stat = "identity") +
coord_polar(theta = "y") + # esto permite hacer gráfico de torta
labs(title = "Religión en Estados Unidos",
subtitle = "según datos de CENSO",
caption = "fuente: Libreria Datos",
fill = "Religión") +
theme_ipsum() +
scale_fill_discrete( guide = "legend", limits = f_religion$Religion)
datos$raza <- datos$raza %>% fct_relevel(c("Blanca", "Negra", "Otra")) %>%
fct_drop("No aplica") #ordeno los resultados según raza y elimino la categoría no aplica
datos$religion <- datos$religion %>% fct_relevel(c("Protestante",
"Católica",
"Ninguna",
"Cristiana",
"Judía",
"Budismo",
"Inter o no confesional",
"Musulmana/Islam",
"Cristiana ortodoxa",
"Hinduismo",
"Otra religión oriental",
"Nativa americana",
"Otra",
"No sabe",
"No aplica",
"Sin respuesta"
)) %>%
fct_drop("No aplica")
ggplot(data = datos, aes(x = raza, fill = religion)) +
geom_bar(position = "fill") + ylab("Proporciones")+
theme_classic()
colors <- c("#440154", "#b2df8a", "#365A8C", "#277E8E", "#1FA088", "#44A96C", "#7FBC41",
"#B3CC2A", "#FDE725", "#46337E", "#b07aa1", "#ff9da7", "#9c755f",
"#bab0ac", "#5c5c5c")
ggplot(data = datos, aes(x = raza, fill = religion)) +
geom_bar(position = "fill") +
ylab("Proporciones") +
theme_classic() +
scale_fill_manual(values = colors) #poner los colores manualmente
datos %>%
mutate(partido = as.character(partido)) %>%
mutate(partido = if_else(partido %in% c("Sin respuesta", "No aplica"), as.character(NA), partido)) %>%
freq(partido, prop = TRUE, order = "freq", report.nas =  FALSE)
datos <- datos %>%
mutate(partido_r = case_when(partido ==  "No fuertemente demócrata" ~ "Demócrata",
partido ==  "Fuertemente demócrata" ~ "Demócrata",
partido ==  "Ind, pro dem" ~ "Demócrata",
partido ==  "Fuertemente republicano" ~ "Republicano",
partido ==  "No fuertemente republicano" ~ "Republicano",
partido ==  "Ind, pro rep" ~ "Republicano",
partido ==  "Otro partido" ~ "Otro partido",
partido ==  "Independiente" ~ "Independiente",
partido ==  "No sabe" ~ "No sabe"))
class(datos$partido_r)
datos$partido_r <- as.factor(datos$partido_r) #por qué se transforma a factor?
class(datos$partido_r)
datos$partido_r <- datos$partido_r %>% fct_relevel(c("Demócrata", "Republicano",
"Independiente", "Otro partido", "No sabe"))
ggplot(data = datos, aes(x = raza, fill = partido_r)) +
geom_bar(position = "fill") +
ylab("Proporciones") +
theme_classic() +
scale_fill_manual(values = colors)
ggplot(data = na.omit(datos), aes(x = raza, fill = partido_r)) + #esto elimina datos perdidos
geom_bar(position = "fill") +
ylab("Orientación Política") +
theme_classic() +
scale_fill_manual(values = colors) +
labs(fill = "Orientación Política")
ggplot(data = na.omit(datos), aes(x = partido_r)) +
geom_bar() +
ylab("Frecuencias") +
theme_classic()+
facet_wrap (~ raza) +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(data = na.omit(datos), aes(x = partido_r, fill=partido_r)) +
geom_bar() +
ylab("Frecuencias") +
xlab("Orientación Política") +
theme_classic()+
facet_wrap (~ raza) +
theme(axis.text.x = element_text(angle = 90, hjust = 1))+
labs(fill = "Orientación Política")
library(chilemapas)
poblacion_adulto_mayor_comunas <- censo_2017_comunas %>%
filter(as.integer(edad) >= 14) %>%
group_by(codigo_comuna) %>%
summarise(pob_adulto_mayor = sum(poblacion))
comunas_los_rios <- mapa_comunas %>%
filter(codigo_region == 14) %>%
left_join(
codigos_territoriales %>%
select(matches("comuna"))
) %>%
left_join(poblacion_adulto_mayor_comunas)
# estos colores vienen del paquete colRoz
# https://github.com/jacintak/colRoz
paleta <- c("#DCA761", "#CFB567", "#BFBC71", "#9EA887", "#819897")
ggplot(comunas_los_rios) +
geom_sf(aes(fill = pob_adulto_mayor, geometry = geometry)) +
geom_sf_label(aes(label = nombre_comuna, geometry = geometry)) +
scale_fill_gradientn(colours = rev(paleta), name = "Poblacion\nadulto mayor") +
labs(title = "Poblacion de 65 anios y mas en la Region de los Rios") +
theme_minimal(base_size = 13)
pacman::p_load(tidyverse, openxlsx, readxl,readr,janitor, forcats, writexl, DataExplorer,
datos,  knitr, gt,
summarytools, ggthemes)
#abro la base a trabajar
datos <- datos::encuesta
#hacerlo sin tidyverse
table(datos$religion, datos$raza)
datos %>%
select(religion, raza) %>%
table() #así funciona, primeramente seleccionamos y luego hacemos la tabla
#ahora realizo la tabla y le saco proporciones
datos %>%
select(religion, raza) %>%
table(.) %>%
prop.table(.)*100
#elimino categoría sin respuesta
datos %>%
filter(religion != "Sin respuesta") %>%
select(religion, raza) %>%
droplevels() %>% #elimina las categorías que no se utilizan en la columna
table(.) %>%
prop.table(.)*100
#ahora realizo la tabla y le saco proporciones
datos %>%
select(religion, raza) %>%
table(.) %>%
prop.table(.)*100
#ahora realizo la tabla y le saco proporciones
datos %>%
select(religion, raza) %>%
table(.) %>%
prop.table(.)*100
datos %>%
select(religion, raza) %>%
table() #así funciona, primeramente seleccionamos y luego hacemos la tabla
datos %>%
select(religion, raza) %>%
table()
datos$raza <- datos$raza %>% fct_relevel(c("Blanca", "Negra", "Otra")) %>%
fct_drop("No aplica") #ordeno los resultados según raza y elimino la categoría no aplica
datos %>%
select(religion, raza) %>%
table()
datos %>%
select(religion, raza) %>%
table() %>%
chisq.test(.)
datos %>%
select(religion, raza) %>%
table()
datos %>%
select(religion, raza) %>%
table() %>%
chisq.test()
datos %>%
select(religion, raza) %>%
table() %>%
chisq.test()
datos %>%
select(religion, raza) %>%
table()
datos$religion <- datos$religion %>% fct_relevel(c("Protestante",
"Católica",
"Ninguna",
"Cristiana",
"Judía",
"Budismo",
"Inter o no confesional",
"Musulmana/Islam",
"Cristiana ortodoxa",
"Hinduismo",
"Otra religión oriental",
"Nativa americana",
"Otra",
"No sabe",
"No aplica",
"Sin respuesta"
)) %>%
fct_drop("No aplica")
datos %>%
select(religion, raza) %>%
table() %>%
chisq.test()
# Test de ficher
datos %>%
select(religion, raza) %>%
table() %>%
fisher.test()
#01.3. Aproximandonos a la prueba de hipótesis chi cuadrado ####
ctable( x = datos$religion, y = datos$raza, prop = "c", justify = "l",
chisq = T)
# Chi cuadrado
datos %>%
select(religion, raza) %>%
table() %>%
chisq.test()
ctable( x = datos$religion, y = datos$raza, prop = "c", justify = "l",
chisq = T)
xaringan:::inf_mr()
datos <- datos %>%
mutate(partido_r = case_when(partido ==  "No fuertemente demócrata" ~ "Demócrata",
partido ==  "Fuertemente demócrata" ~ "Demócrata",
partido ==  "Ind, pro dem" ~ "Demócrata",
partido ==  "Fuertemente republicano" ~ "Republicano",
partido ==  "No fuertemente republicano" ~ "Republicano",
partido ==  "Ind, pro rep" ~ "Republicano",
partido ==  "Otro partido" ~ "Otro partido",
partido ==  "Independiente" ~ "Independiente",
partido ==  "No sabe" ~ "No sabe"))
datos <- datos %>%
mutate(partido_r = case_when(partido ==  "No fuertemente demócrata" ~ "Demócrata",
partido ==  "Fuertemente demócrata" ~ "Demócrata",
partido ==  "Ind, pro dem" ~ "Demócrata",
partido ==  "Fuertemente republicano" ~ "Republicano",
partido ==  "No fuertemente republicano" ~ "Republicano",
partido ==  "Ind, pro rep" ~ "Republicano",
partido ==  "Otro partido" ~ "Otro partido",
partido ==  "Independiente" ~ "Independiente",
partido ==  "No sabe" ~ "No sabe"))
#abro la base a trabajar
datos <- datos::encuesta
datos <- datos %>%
mutate(partido_r = case_when(partido ==  "No fuertemente demócrata" ~ "Demócrata",
partido ==  "Fuertemente demócrata" ~ "Demócrata",
partido ==  "Ind, pro dem" ~ "Demócrata",
partido ==  "Fuertemente republicano" ~ "Republicano",
partido ==  "No fuertemente republicano" ~ "Republicano",
partido ==  "Ind, pro rep" ~ "Republicano",
partido ==  "Otro partido" ~ "Otro partido",
partido ==  "Independiente" ~ "Independiente",
partido ==  "No sabe" ~ "No sabe"))
class(datos$partido_r)
datos$partido_r <- as.factor(datos$partido_r) #por qué se transforma a factor?
class(datos$partido_r)
datos$partido_r <- datos$partido_r %>% fct_relevel(c("Demócrata", "Republicano",
"Independiente", "Otro partido", "No sabe"))
datos %>%
select(partido_r, raza) %>%
table()
datos$partido_r <- datos$partido_r %>% fct_relevel(c("Demócrata", "Republicano",
"Independiente", "Otro partido", "No sabe"))
datos$raza <- datos$raza %>% fct_relevel(c("Blanca", "Negra", "Otra")) %>%
fct_drop("No aplica") #ordeno los resultados según raza y elimino la categoría no aplica
datos %>%
select(partido_r, raza) %>%
table()
# Test de fisher
datos %>%
select(partido_r, raza) %>%
table() %>%
fisher.test()
datos %>%
select(partido_r, raza) %>%
table() %>%
subset(select = -c("No sabe"))
# Test de fisher
datos %>%
select(partido_r, raza) %>%
table() %>%
fisher.test()
# Test de fisher
datos %>%
select(partido_r, raza) %>%
table() %>%
chisq.test()
