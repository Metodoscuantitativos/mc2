View(datos)
View(datos)
#veo categorías de todas las variables
sapply(datos, FUN = unique)
#posibilidad de renombrar uno por uno las variables de interés.
datos <- datos %>% dplyr::rename(nombre = p01,  # primero nuevo nombre y luego nombre antiguo
edad = p02,
genero = p03,
annio = p04,
comuna_actual = p05,
comuna_pre= p06,
tipo_colegio = p07,
puntaje = p08,
estudio_trabajo = p09,
educacion_madre = p10,
trabaja_madre =p11,
empleo_madre =p12,
educacion_padre =p13,
trabaja_padre =p14,
empleo_padre = p15,
psdhogar = p17,
clase_social_subjetiva = p18)
View(importacion)
View(datos)
# selección y transformación de variables ---------------------------------
DataExplorer::create_report(datos)
names (datos)
unique(datos$comuna_actual)
# para comuna actual
datos$comuna_actual <- tolower(datos$comuna_actual) #todas a minusculas
datos$comuna_actual <- tolower(datos$comuna_actual)
datos$comuna_actual
datos$comuna_actual  <- gsub(pattern = " ", replacement = "", x = datos$comuna_actual) #elimino los espacios
table(datos$comuna_actual)
# para comuna pre
datos$comuna_pre <- tolower(datos$comuna_pre)
datos$comuna_pre  <- gsub(" ", "", datos$comuna_pre)
table(datos$comuna_pre)
datos$comuna_actual  <- gsub("[áÁ]", "a", x = datos$comuna_actual)
datos$comuna_actual  <- gsub("[éÉ]", "e", x = datos$comuna_actual)
datos$comuna_actual  <- gsub("[íÍ]", "i", x = datos$comuna_actual)
datos$comuna_actual  <- gsub("[óÓ]", "o", x = datos$comuna_actual)
datos$comuna_actual  <- gsub("[úÚ]", "u", x = datos$comuna_actual)
datos$comuna_actual  <- gsub("ñ", "n", x = datos$comuna_actual)
table(datos$comuna_actual)
table(datos$comuna_actual)
datos$comuna_pre  <- gsub("[áÁ]", "a", x = datos$comuna_pre)
datos$comuna_pre  <- gsub("[éÉ]", "e", x = datos$comuna_pre)
datos$comuna_pre  <- gsub("[íÍ]", "i", x = datos$comuna_pre)
datos$comuna_pre  <- gsub("[óÓ]", "o", x = datos$comuna_pre)
datos$comuna_pre  <- gsub("[úÚ]", "u", x = datos$comuna_pre)
datos$comuna_pre  <- gsub("ñ", "n", x = datos$comuna_pre)
table(datos$comuna_pre)
datos <- datos %>%
mutate(empleo_madre = stringi::stri_trans_general(empleo_madre, "Latin-ASCII"),
empleo_padre = stringi::stri_trans_general(empleo_padre, "Latin-ASCII"),
empleo_madre = tolower (empleo_madre),
empleo_padre = tolower (empleo_padre),
empleo_madre = gsub(" ", "_", empleo_madre),
empleo_padre= gsub(" ", "_", empleo_padre))
table(datos$empleo_madre)
table(datos$empleo_padre)
#limpieza de datos
table(datos$puntaje)
class(datos$puntaje)
unique (datos$puntaje)
datos <- datos %>%
mutate(puntaje = ifelse(puntaje == "700+", yes= "700", no= puntaje))
table(datos$puntaje)
class(datos$puntaje) # observo que está en character, ¿Qué pasa si está en character?
datos$puntaje <- as.numeric(datos$puntaje) #lo transformo a numeric
class(datos$puntaje)
table(datos$edad) #observo las frecuencias de edad
datos <- datos %>%
mutate (edadr= case_when (edad %in% c(18:20) ~ "18 a 20",
edad %in% c(21:23) ~ "21 a 23",
edad %in% c(24:29) ~ "24 a 29",
edad >= 30 ~ "30 o más"))
table(datos$edadr) # observo la recodificación
class(datos$edad)
class(datos$edadr)
datos <-  datos %>%
mutate(generacion = ifelse(educacion_madre %in% c("Ed. Universitaria (comp. o incomp.)", "Posgrado (Magister, Doctorado)" ) |
educacion_padre %in% c("Ed. Universitaria (comp. o incomp.)", "Posgrado (Magister, Doctorado)" ),
"No es primera generación",
"Si es primera generación"))
table (datos$generacion) #observo mi recodificación
datos <-  datos %>%
mutate(generacion = ifelse(educacion_madre %in% c("Ed. Universitaria (comp. o incomp.)", "Posgrado (Magister, Doctorado)" ) |
educacion_padre %in% c("Ed. Universitaria (comp. o incomp.)", "Posgrado (Magister, Doctorado)" ),
"No es primera generación",
"Si es primera generación"))
table (datos$generacion) #observo mi recodificación
#observo la base
str(datos)
dplyr::glimpse(datos)
library(chilemapas)
poblacion_adulto_mayor_comunas <- censo_2017_comunas %>%
filter(as.integer(edad) >= 14) %>%
group_by(codigo_comuna) %>%
summarise(pob_adulto_mayor = sum(poblacion))
comunas_los_rios <- mapa_comunas %>%
filter(codigo_region == 14) %>%
left_join(
codigos_territoriales %>%
select(matches("comuna"))
) %>%
left_join(poblacion_adulto_mayor_comunas)
# estos colores vienen del paquete colRoz
# https://github.com/jacintak/colRoz
paleta <- c("#DCA761", "#CFB567", "#BFBC71", "#9EA887", "#819897")
ggplot(comunas_los_rios) +
geom_sf(aes(fill = pob_adulto_mayor, geometry = geometry)) +
geom_sf_label(aes(label = nombre_comuna, geometry = geometry)) +
scale_fill_gradientn(colours = rev(paleta), name = "Poblacion\nadulto mayor") +
labs(title = "Poblacion de 65 anios y mas en la Region de los Rios") +
theme_minimal(base_size = 13)
write.xlsx(x = datos,file = "base/Encuesta_Antropología_Limpia")
#Importar el archivo y la asigno en el environment
pham <- read.xlsx(xlsxFile = "base/ALTO MAIPO.xlsx", colNames = TRUE, detectDates = TRUE)
# install.packages("pacman")
pacman::p_load(tidyverse, openxlsx, readxl,readr,janitor, forcats, writexl, DataExplorer) #dos formatos de excel xlsx y xl
#Importar el archivo y la asigno en el environment
pham <- read.xlsx(xlsxFile = "base/ALTO MAIPO.xlsx", colNames = TRUE, detectDates = TRUE)
names(pham) #observo que hay puntos, mayúsculas y minúsculas, etcétera. Está sucia
#limpieza inicial
pham <- janitor::clean_names(pham) #con esto transformo todo a minúscula, quito tildes, saco signos, borro espacios
names(pham)
#observación de base
nrow(pham) # cantidad de casos
ncol(pham) # cantidad de variables
sapply(pham, FUN = class) # sapply: realiza un a función a varias variables
str(pham)
#extraigo el nombre de todas las variables
names (pham)
# genero un vector con todas las columnas que quiero renombrar
cols_a_renombrar <- c(
"comuna",
"localidad",
"edad",
"sexo",
"otra_comuna",
"hace_cuantos_anos_vive_en_esta_comuna_enc_anotar_cantidad_de_anos_si_es_menos_de_un_ano_anotar_0",
"la_vivienda_que_usted_ocupa_es_enc_leer_alternativas",
"cual_es_el_valor_que_paga_mensualmente",
"parentezco_con_jedfe_de_hogar",
"edad_2",
"genero",
"situacion_ocupacional",
"cual_es_la_ocupacion_principal_del_jefe_de_hogar_enc_respuesta_espontanea_clasificar_en_una_de_las_siguientes_categorias",
"principales_traslados",
"lugar_traslado",
"temporalidad_traslado",
"medio_transporte",
"tiempo_traslado",
"a_que_sistema_de_salud_pertenece_su_familia_enc_leer_alternativas_y_responder_todas_las_que_correspondan",
"cuando_usted_o_algun_familiar_necesita_atencion_de_salud_adonde_acude_principalmente_enc_leer_alternativas_y_responder_una",
"ha_cambiado_la_calidad_de_la_atencion_en_los_ultimos_seis_meses",
"si_nota_un_cambio_como_ha_cambiado_en_enc_leer_cada_tipo_de_cambio_y_anotar_1_si_2_no_todos_los_tipos_de_cambios_deben_quedar_con_una_respuesta_anotada",
"en_los_ultimos_seis_meses_han_ocurrido_incidentes_que_alteren_el_orden_publico_en_la_localidad_donde_vive_enc_leer_alternativas_y_responder_una",
"la_presencia_de_aes_gener_en_la_comuna_le_ha_traido_beneficios_a_usted_o_a_su_familia_enc_leer_cada_tipo_de_beneficio_todos_los_tipos_de_beneficios_deben_quedar_con_una_respuesta_anotada",
"usted_conoce_el_mecanismo_por_el_cual_opera_la_produccion_de_electricidad_en_la_central_hidroelectrica_alto_maipo",
"solo_si_conoce_el_mecanismo_me_podria_indicar_cual_es_el_mecanismo_que_se_utiliza",
"desde_el_inicio_de_las_actividades_de_alto_maipo_ha_notado_diferencias_en_el_nivel_del_caudal_del_rio_enc_leer_cada_uno_de_los_ambitos_elegir_una_alternativa" )
#genero un vector sólo con las 3 primeras letras: p01
nuevos_nombres <- str_sub(string = cols_a_renombrar, start = 1, end = 4 ) #muestro los argumentos
nuevos_nombres
#renombro considerando todas las columnas elegidas asignando nuevos nombres
pham <- pham %>%
rename_at(vars(cols_a_renombrar), ~ nuevos_nombres) #recodificación múltiples con un vector
pham$edad_2
# install.packages("pacman")
pacman::p_load(tidyverse, openxlsx, readxl,readr,janitor, forcats, writexl, DataExplorer) #dos formatos de excel xlsx y xl
#Importar el archivo y la asigno en el environment
pham <- read.xlsx(xlsxFile = "base/ALTO MAIPO.xlsx", colNames = TRUE, detectDates = TRUE)
names(pham) #observo que hay puntos, mayúsculas y minúsculas, etcétera. Está sucia
#limpieza inicial
pham <- janitor::clean_names(pham) #con esto transformo todo a minúscula, quito tildes, saco signos, borro espacios
names(pham)
# genero un vector con todas las columnas que quiero renombrar
cols_a_renombrar <- c(
"comuna",
"localidad",
"sexo",
"otra_comuna",
"hace_cuantos_anos_vive_en_esta_comuna_enc_anotar_cantidad_de_anos_si_es_menos_de_un_ano_anotar_0",
"la_vivienda_que_usted_ocupa_es_enc_leer_alternativas",
"cual_es_el_valor_que_paga_mensualmente",
"parentezco_con_jedfe_de_hogar",
"edad_2",
"genero",
"situacion_ocupacional",
"cual_es_la_ocupacion_principal_del_jefe_de_hogar_enc_respuesta_espontanea_clasificar_en_una_de_las_siguientes_categorias",
"principales_traslados",
"lugar_traslado",
"temporalidad_traslado",
"medio_transporte",
"tiempo_traslado",
"a_que_sistema_de_salud_pertenece_su_familia_enc_leer_alternativas_y_responder_todas_las_que_correspondan",
"cuando_usted_o_algun_familiar_necesita_atencion_de_salud_adonde_acude_principalmente_enc_leer_alternativas_y_responder_una",
"ha_cambiado_la_calidad_de_la_atencion_en_los_ultimos_seis_meses",
"si_nota_un_cambio_como_ha_cambiado_en_enc_leer_cada_tipo_de_cambio_y_anotar_1_si_2_no_todos_los_tipos_de_cambios_deben_quedar_con_una_respuesta_anotada",
"en_los_ultimos_seis_meses_han_ocurrido_incidentes_que_alteren_el_orden_publico_en_la_localidad_donde_vive_enc_leer_alternativas_y_responder_una",
"la_presencia_de_aes_gener_en_la_comuna_le_ha_traido_beneficios_a_usted_o_a_su_familia_enc_leer_cada_tipo_de_beneficio_todos_los_tipos_de_beneficios_deben_quedar_con_una_respuesta_anotada",
"usted_conoce_el_mecanismo_por_el_cual_opera_la_produccion_de_electricidad_en_la_central_hidroelectrica_alto_maipo",
"solo_si_conoce_el_mecanismo_me_podria_indicar_cual_es_el_mecanismo_que_se_utiliza",
"desde_el_inicio_de_las_actividades_de_alto_maipo_ha_notado_diferencias_en_el_nivel_del_caudal_del_rio_enc_leer_cada_uno_de_los_ambitos_elegir_una_alternativa" )
# genero un vector con todas las columnas que quiero renombrar
cols_a_renombrar <- c(
"comuna",
"localidad",
"sexo",
"otra_comuna",
"hace_cuantos_anos_vive_en_esta_comuna_enc_anotar_cantidad_de_anos_si_es_menos_de_un_ano_anotar_0",
"la_vivienda_que_usted_ocupa_es_enc_leer_alternativas",
"cual_es_el_valor_que_paga_mensualmente",
"parentezco_con_jedfe_de_hogar",
"edad",
"genero",
"situacion_ocupacional",
"cual_es_la_ocupacion_principal_del_jefe_de_hogar_enc_respuesta_espontanea_clasificar_en_una_de_las_siguientes_categorias",
"principales_traslados",
"lugar_traslado",
"temporalidad_traslado",
"medio_transporte",
"tiempo_traslado",
"a_que_sistema_de_salud_pertenece_su_familia_enc_leer_alternativas_y_responder_todas_las_que_correspondan",
"cuando_usted_o_algun_familiar_necesita_atencion_de_salud_adonde_acude_principalmente_enc_leer_alternativas_y_responder_una",
"ha_cambiado_la_calidad_de_la_atencion_en_los_ultimos_seis_meses",
"si_nota_un_cambio_como_ha_cambiado_en_enc_leer_cada_tipo_de_cambio_y_anotar_1_si_2_no_todos_los_tipos_de_cambios_deben_quedar_con_una_respuesta_anotada",
"en_los_ultimos_seis_meses_han_ocurrido_incidentes_que_alteren_el_orden_publico_en_la_localidad_donde_vive_enc_leer_alternativas_y_responder_una",
"la_presencia_de_aes_gener_en_la_comuna_le_ha_traido_beneficios_a_usted_o_a_su_familia_enc_leer_cada_tipo_de_beneficio_todos_los_tipos_de_beneficios_deben_quedar_con_una_respuesta_anotada",
"usted_conoce_el_mecanismo_por_el_cual_opera_la_produccion_de_electricidad_en_la_central_hidroelectrica_alto_maipo",
"solo_si_conoce_el_mecanismo_me_podria_indicar_cual_es_el_mecanismo_que_se_utiliza",
"desde_el_inicio_de_las_actividades_de_alto_maipo_ha_notado_diferencias_en_el_nivel_del_caudal_del_rio_enc_leer_cada_uno_de_los_ambitos_elegir_una_alternativa" )
#genero un vector sólo con las 3 primeras letras: p01
nuevos_nombres <- str_sub(string = cols_a_renombrar, start = 1, end = 4 ) #muestro los argumentos
nuevos_nombres <- str_sub(cols_a_renombrar, 1, 4)  #no muestro los argumentos
nuevos_nombres
#renombro considerando todas las columnas elegidas asignando nuevos nombres
pham <- pham %>%
rename_at(vars(cols_a_renombrar), ~ nuevos_nombres) #recodificación múltiples con un vector
#veo categorías de todas las variables
sapply(pham, FUN = unique)
#posibilidad de renombrar uno por uno las variables de interés.
pham <- pham %>% dplyr::rename(pago_vivienda = cual_es_el_valor_que_paga_mensualmente,  # primero nuevo nombre y luego nombre antiguo
ocupacion_jefe_hogar = cual_es_la_ocupacion_principal_del_jefe_de_hogar_enc_respuesta_espontanea_clasificar_en_una_de_las_siguientes_categorias,
genero = p03,
annio = p04,
comuna_actual = p05,
comuna_pre= p06,
tipo_colegio = p07,
puntaje = p08,
estudio_trabajo = p09,
educacion_madre = p10,
trabaja_madre =p11,
empleo_madre =p12,
educacion_padre =p13,
trabaja_padre =p14,
empleo_padre = p15,
psdhogar = p17,
clase_social_subjetiva = p18)
# 01. Repaso: Actividad de subsetting ------------------------------------------
#Considerando la siguiente base
Candidato <- c("Kast", "Boric")
Votos <- c("64000", "78000")
Mesas <- c("Mesa1", "Mesa1")
Conteo <- data.frame(Candidato, Votos, Mesas)
#Actividad: realice las siguientes selecciones con r base y tidyverse
#1. Seleccionar solo la columna votos: por posición y por nombre de variable
#r_base
Conteo[,2]
Conteo[, "Votos"]
#tidyverse
library(tidyverse)
Conteo %>%
select(2)
Conteo %>%
select(Votos) #ojo en select de tidyverse no se usan las comillas
#2. Seleccionar la fila 1 y columna 1 y 2.
Conteo[1, c(1,2)]
Conteo %>%
slice(1) %>%  #casos
select(1,2) #variables
#3. Seleccionar columna 2 mediante operador $.
Conteo$Votos
#4. Selccionar la fila 1 y columna 1 y 3.
Conteo[1, c("Candidato", "Votos", "Mesas")]
#5. Seleccionar fila 2, además de la columna 3.
Conteo[1, c(1,3)]
Conteo[2, 3]
#02. Introducción-------------------------------------------------
#flujo de trabajo
#orden del script
#Tipos de datos ------------------------------------------------------
#1. Tipo numeric: números
#especificando:
#(integer): enteros: 1,2,3,4, etc.
#(double): con decimales
a <- c(1:10)
b <- c(1, 5, 200, 500)
c <- c(30, 35, 26, 47)
names(b) <- c("antropologia", "sociologia", "geografía", "historia")
#2. Tipo character
nombres <- c ("pedro", "juan", "diego")
#3. Factor: se suele usa para variables ordinales
factor1 <-  factor(c("orange", "red", "yellow"))
factor2 <- factor(c("ABC1","C2C3", "DE" ))
#otros ejemplo
genero <- c(1,2,2,2,1,2,1,99,99)
genero_f <- factor(genero, labels = c("Hombre", "Mujer", NA))
table(genero_f)
#4. Lógico
lógico = c(FALSE, FALSE, TRUE, TRUE)
#Coerción explícita####
x <- as.numeric(c(2,4,6,8,10))
q <- as.character(c("Valparaíso", "Santiago", "Viña del Mar"))
q <- as.factor(c("Santiago", "Valparaíso", "Viña del Mar"))
table(q)
y <- as.factor(c("ABC1", "C2", "C3", "D", "E"))
z <- as.logical(c(TRUE, TRUE, FALSE))
t <- as.Date("22-10-2020")
#class(): identificar el tipo de objeto
class(t)
#qué pasa si yo tranformo un numérico a character
x <- as.character(x)
#bases de datos####
#data frame
Candidato <- c("Kast", "Boric")
Votos <- c("64000", "78000")
Mesas <- c("Mesa1", "Mesa1")
opcion_2 <- data.frame(Candidato, Votos, Mesas)
opcion_2
class(opcion_2)
# listas####
# objeto que puede almacenar muchos tipos de datos
mi.lista <- list("letras" =  letters[1:4], opcion_2 =  opcion_2, numeros = c(1,2,3))
mi.lista_mal <- list("letras" <-   letters[1:4], opcion_2 <-  opcion_2, numeros <- c(1,2,3))
#acceso
mi.lista [[1]]
mi.lista [[2]]
mi.lista [[3]]
mi.lista[["letras"]]
mi.lista[["opcion_2"]]
mi.lista$letras
class(mi.lista [[1]])
class(mi.lista [[2]])
class(mi.lista [[3]])
# install.packages("pacman")
pacman::p_load(tidyverse,
readxl,
janitor,
forcats,
writexl,
DataExplorer)
#Importar el archivo y asignarlo en el environment----
pham <- read.xlsx(xlsxFile = "base/ALTO MAIPO.xlsx", colNames = TRUE, detectDates = TRUE)
# install.packages("pacman")
pacman::p_load(tidyverse,
readxl,
janitor,
forcats, writexl, DataExplorer) #dos formatos de excel xlsx y xl
#Importar el archivo y asignarlo en el environment----
pham <- read.xlsx(xlsxFile = "base/ALTO MAIPO.xlsx", colNames = TRUE, detectDates = TRUE)
#Importar el archivo y asignarlo en el environment----
pham <- read.xlsx(xlsxFile = "base/ALTO MAIPO.xlsx", colNames = TRUE, detectDates = TRUE)
# install.packages("pacman")
pacman::p_load(tidyverse,# Universo de paquetes : tidyr, dplyr, ggplot2,readr,purrr,tibble, stringr, forcats
openxlsx,#leer archivos xlsx
readxl,# leer archivos xl      #dos formatos de excel xlsx y xl
janitor,#limpieza de datos
writexl,#Guardar tablas formato excel
DataExplorer) #Exploración rápida
#Importar el archivo y asignarlo en el environment----
pham <- read.xlsx(xlsxFile = "base/ALTO MAIPO.xlsx", colNames = TRUE, detectDates = TRUE)
names(pham) #observo que hay puntos, mayúsculas y minúsculas, etcétera. Está sucia
#limpieza inicial----
pham <- janitor::clean_names(pham) #con esto transformo todo a minúscula, quito tildes, saco signos, borro espacios
names(pham)
nrow(pham) # cantidad de casos
ncol(pham) # cantidad de variables
sapply(pham, FUN = class) # sapply: realiza un a función a varias variables
str(pham)
#extraigo el nombre de todas las variables
names (pham)
# genero un vector con todas las columnas que quiero renombrar
cols_a_renombrar <- c(
"comuna",
"localidad",
"sexo",
"otra_comuna",
"hace_cuantos_anos_vive_en_esta_comuna_enc_anotar_cantidad_de_anos_si_es_menos_de_un_ano_anotar_0",
"la_vivienda_que_usted_ocupa_es_enc_leer_alternativas",
"cual_es_el_valor_que_paga_mensualmente",
"parentezco_con_jedfe_de_hogar",
"edad",
"genero",
"situacion_ocupacional",
"cual_es_la_ocupacion_principal_del_jefe_de_hogar_enc_respuesta_espontanea_clasificar_en_una_de_las_siguientes_categorias",
"principales_traslados",
"lugar_traslado",
"temporalidad_traslado",
"medio_transporte",
"tiempo_traslado",
"a_que_sistema_de_salud_pertenece_su_familia_enc_leer_alternativas_y_responder_todas_las_que_correspondan",
"cuando_usted_o_algun_familiar_necesita_atencion_de_salud_adonde_acude_principalmente_enc_leer_alternativas_y_responder_una",
"ha_cambiado_la_calidad_de_la_atencion_en_los_ultimos_seis_meses",
"si_nota_un_cambio_como_ha_cambiado_en_enc_leer_cada_tipo_de_cambio_y_anotar_1_si_2_no_todos_los_tipos_de_cambios_deben_quedar_con_una_respuesta_anotada",
"en_los_ultimos_seis_meses_han_ocurrido_incidentes_que_alteren_el_orden_publico_en_la_localidad_donde_vive_enc_leer_alternativas_y_responder_una",
"la_presencia_de_aes_gener_en_la_comuna_le_ha_traido_beneficios_a_usted_o_a_su_familia_enc_leer_cada_tipo_de_beneficio_todos_los_tipos_de_beneficios_deben_quedar_con_una_respuesta_anotada",
"usted_conoce_el_mecanismo_por_el_cual_opera_la_produccion_de_electricidad_en_la_central_hidroelectrica_alto_maipo",
"solo_si_conoce_el_mecanismo_me_podria_indicar_cual_es_el_mecanismo_que_se_utiliza",
"desde_el_inicio_de_las_actividades_de_alto_maipo_ha_notado_diferencias_en_el_nivel_del_caudal_del_rio_enc_leer_cada_uno_de_los_ambitos_elegir_una_alternativa" )
#genero un vector sólo con las 3 primeras letras: p01
nuevos_nombres <- str_sub(string = cols_a_renombrar, start = 1, end = 4 ) #muestro los argumentos
nuevos_nombres <- str_sub(cols_a_renombrar, 1, 4)  #no muestro los argumentos
nuevos_nombres
#renombro considerando todas las columnas elegidas asignando nuevos nombres
pham <- pham %>%
rename_at(vars(cols_a_renombrar), ~ nuevos_nombres) #recodificación múltiples con un vector
unique(pham$cuando_usted_o_algun_familiar_necesita_atencion_de_salud_adonde_acude_principalmente_enc_leer_alternativas_y_responder_una)
unique(pham$si_nota_un_cambio_como_ha_cambiado_en_enc_leer_cada_tipo_de_cambio_y_anotar_1_si_2_no_todos_los_tipos_de_cambios_deben_quedar_con_una_respuesta_anotada)
#posibilidad de renombrar uno por uno las variables de interés. # primero nuevo nombre y luego nombre antiguo
pham <- pham %>% dplyr::rename(sistema_salud = a_que_sistema_de_salud_pertenece_su_familia_enc_leer_alternativas_y_responder_todas_las_que_correspondan,
pago_vivienda = cual_es_el_valor_que_paga_mensualmente,
ocupacion_jefe_hogar = cual_es_la_ocupacion_principal_del_jefe_de_hogar_enc_respuesta_espontanea_clasificar_en_una_de_las_siguientes_categorias,
servicio_salud = cuando_usted_o_algun_familiar_necesita_atencion_de_salud_adonde_acude_principalmente_enc_leer_alternativas_y_responder_una,
calidad_atencion = ha_cambiado_la_calidad_de_la_atencion_en_los_ultimos_seis_meses,
cambio_atencion = si_nota_un_cambio_como_ha_cambiado_en_enc_leer_cada_tipo_de_cambio_y_anotar_1_si_2_no_todos_los_tipos_de_cambios_deben_quedar_con_una_respuesta_anotada,
ocurrencia_incidentes= en_los_ultimos_seis_meses_han_ocurrido_incidentes_que_alteren_el_orden_publico_en_la_localidad_donde_vive_enc_leer_alternativas_y_responder_una,
beneficios_aes_gener = la_presencia_de_aes_gener_en_la_comuna_le_ha_traido_beneficios_a_usted_o_a_su_familia_enc_leer_cada_tipo_de_beneficio_todos_los_tipos_de_beneficios_deben_quedar_con_una_respuesta_anotada,
mecanismo_produccion = usted_conoce_el_mecanismo_por_el_cual_opera_la_produccion_de_electricidad_en_la_central_hidroelectrica_alto_maipo,
nombre_mecanismo = solo_si_conoce_el_mecanismo_me_podria_indicar_cual_es_el_mecanismo_que_se_utiliza,
diferencia_caudal = desde_el_inicio_de_las_actividades_de_alto_maipo_ha_notado_diferencias_en_el_nivel_del_caudal_del_rio_enc_leer_cada_uno_de_los_ambitos_elegir_una_alternativa)
names(pham)
#Importar el archivo y asignarlo en el environment----
pham <- read.xlsx(xlsxFile = "base/ALTO MAIPO.xlsx", colNames = TRUE, detectDates = TRUE)
# install.packages("pacman")
pacman::p_load(tidyverse,# Universo de paquetes : tidyr, dplyr, ggplot2,readr,purrr,tibble, stringr, forcats
openxlsx,#leer archivos xlsx
readxl,# leer archivos xl      #dos formatos de excel xlsx y xl
janitor,#limpieza de datos
writexl,#Guardar tablas formato excel
DataExplorer) #Exploración rápida
#Importar el archivo y asignarlo en el environment----
pham <- read.xlsx(xlsxFile = "base/ALTO MAIPO.xlsx", colNames = TRUE, detectDates = TRUE)
#limpieza inicial----
pham <- janitor::clean_names(pham) #con esto transformo todo a minúscula, quito tildes, saco signos, borro espacios
names(pham)
# genero un vector con todas las columnas que quiero renombrar
cols_a_renombrar <- c(
"comuna",
"localidad",
"sexo",
"otra_comuna",
"hace_cuantos_anos_vive_en_esta_comuna_enc_anotar_cantidad_de_anos_si_es_menos_de_un_ano_anotar_0",
"la_vivienda_que_usted_ocupa_es_enc_leer_alternativas",
"cual_es_el_valor_que_paga_mensualmente",
"parentezco_con_jedfe_de_hogar",
"edad",
"genero",
"situacion_ocupacional",
"cual_es_la_ocupacion_principal_del_jefe_de_hogar_enc_respuesta_espontanea_clasificar_en_una_de_las_siguientes_categorias",
"principales_traslados",
"lugar_traslado",
"temporalidad_traslado",
"medio_transporte",
"tiempo_traslado",
"a_que_sistema_de_salud_pertenece_su_familia_enc_leer_alternativas_y_responder_todas_las_que_correspondan",
"cuando_usted_o_algun_familiar_necesita_atencion_de_salud_adonde_acude_principalmente_enc_leer_alternativas_y_responder_una",
"ha_cambiado_la_calidad_de_la_atencion_en_los_ultimos_seis_meses",
"si_nota_un_cambio_como_ha_cambiado_en_enc_leer_cada_tipo_de_cambio_y_anotar_1_si_2_no_todos_los_tipos_de_cambios_deben_quedar_con_una_respuesta_anotada",
"en_los_ultimos_seis_meses_han_ocurrido_incidentes_que_alteren_el_orden_publico_en_la_localidad_donde_vive_enc_leer_alternativas_y_responder_una",
"la_presencia_de_aes_gener_en_la_comuna_le_ha_traido_beneficios_a_usted_o_a_su_familia_enc_leer_cada_tipo_de_beneficio_todos_los_tipos_de_beneficios_deben_quedar_con_una_respuesta_anotada",
"usted_conoce_el_mecanismo_por_el_cual_opera_la_produccion_de_electricidad_en_la_central_hidroelectrica_alto_maipo",
"solo_si_conoce_el_mecanismo_me_podria_indicar_cual_es_el_mecanismo_que_se_utiliza",
"desde_el_inicio_de_las_actividades_de_alto_maipo_ha_notado_diferencias_en_el_nivel_del_caudal_del_rio_enc_leer_cada_uno_de_los_ambitos_elegir_una_alternativa" )
#genero un vector sólo con las 3 primeras letras: p01
nuevos_nombres <- str_sub(string = cols_a_renombrar, start = 1, end = 4 ) #muestro los argumentos
nuevos_nombres <- str_sub(cols_a_renombrar, 1, 4)  #no muestro los argumentos
nuevos_nombres
#renombro considerando todas las columnas elegidas asignando nuevos nombres
pham <- pham %>%
rename_at(vars(cols_a_renombrar), ~ nuevos_nombres) #recodificación múltiples con un vector
pham <- pham %>% dplyr::rename( anios_comuna = hace_cuantos_anos_vive_en_esta_comuna_enc_anotar_cantidad_de_anos_si_es_menos_de_un_ano_anotar_0,
propiedad_vivienda = la_vivienda_que_usted_ocupa_es_enc_leer_alternativas,
sistema_salud = a_que_sistema_de_salud_pertenece_su_familia_enc_leer_alternativas_y_responder_todas_las_que_correspondan,
pago_vivienda = cual_es_el_valor_que_paga_mensualmente,
ocupacion_jefe_hogar = cual_es_la_ocupacion_principal_del_jefe_de_hogar_enc_respuesta_espontanea_clasificar_en_una_de_las_siguientes_categorias,
servicio_salud = cuando_usted_o_algun_familiar_necesita_atencion_de_salud_adonde_acude_principalmente_enc_leer_alternativas_y_responder_una,
calidad_atencion = ha_cambiado_la_calidad_de_la_atencion_en_los_ultimos_seis_meses,
cambio_atencion = si_nota_un_cambio_como_ha_cambiado_en_enc_leer_cada_tipo_de_cambio_y_anotar_1_si_2_no_todos_los_tipos_de_cambios_deben_quedar_con_una_respuesta_anotada,
ocurrencia_incidentes= en_los_ultimos_seis_meses_han_ocurrido_incidentes_que_alteren_el_orden_publico_en_la_localidad_donde_vive_enc_leer_alternativas_y_responder_una,
beneficios_aes_gener = la_presencia_de_aes_gener_en_la_comuna_le_ha_traido_beneficios_a_usted_o_a_su_familia_enc_leer_cada_tipo_de_beneficio_todos_los_tipos_de_beneficios_deben_quedar_con_una_respuesta_anotada,
mecanismo_produccion = usted_conoce_el_mecanismo_por_el_cual_opera_la_produccion_de_electricidad_en_la_central_hidroelectrica_alto_maipo,
nombre_mecanismo = solo_si_conoce_el_mecanismo_me_podria_indicar_cual_es_el_mecanismo_que_se_utiliza,
diferencia_caudal = desde_el_inicio_de_las_actividades_de_alto_maipo_ha_notado_diferencias_en_el_nivel_del_caudal_del_rio_enc_leer_cada_uno_de_los_ambitos_elegir_una_alternativa)
names(pham)
# selección y transformación de variables ---------------------------------
DataExplorer::create_report(pham)
# para comuna actual
pham$situacion_ocupacional <- tolower(pham$situacion_ocupacional) #todas a minusculas
pham$situacion_ocupacional  <- gsub(pattern = " ", replacement = "", x = pham$situacion_ocupacional) #elimino los espacios
unique(pham$situacion_ocupacional)
View(pham)
glimpse(pham)
pham <- pham[-1,]
#Explorar
glimpse(pham) #Una primera mirada de lo que hay en mis datos, la primera fila es extraña, dice "respuesta" o repite el nombre de la variable.
View(pham)
table(pham$situacion_ocupacional)
table(pham$principales_traslados)
